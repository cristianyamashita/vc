<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-i18n="title">Bandwidth Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../assets/fontawesome/css/all.min.css" />
    <style>
      :root {
        --bg-color: #1a1a1a;
        --text-color: #f0f0f0;
        --card-bg-color: #2a2a2a;
        --border-color: #444;
        --accent-color: #0d6efd;
      }

      html[data-theme='light'] {
        --bg-color: #f8f9fa;
        --text-color: #212529;
        --card-bg-color: #fff;
        --border-color: #dee2e6;
        --accent-color: #0d6efd;
      }

      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        margin: 0;
      }

      .container-fluid {
        padding-top: 20px;
        padding-bottom: 20px;
        flex: 1;
      }

      .card {
        background-color: var(--card-bg-color);
        border-color: var(--border-color);
      }

      .card-header {
        border-bottom-color: var(--border-color);
      }

      .navbar-brand,
      .form-label {
        color: var(--text-color);
      }

      .form-control, .form-select {
        background-color: var(--card-bg-color);
        color: var(--text-color);
        border-color: var(--border-color);
      }

      .form-control:focus, .form-select:focus {
        background-color: var(--card-bg-color);
        color: var(--text-color);
        border-color: var(--accent-color);
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
      }

      .result-box {
        background-color: rgba(13, 110, 253, 0.1);
        border: 1px solid var(--accent-color);
        border-radius: 8px;
        padding: 15px;
        margin-top: 20px;
      }

      .result-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--accent-color);
      }

      .help-text {
        color: #aaa;
        font-size: 0.9rem;
      }

      .mono {
        font-family: 'Courier New', Courier, monospace;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg" style="background-color: var(--card-bg-color); border-bottom: 1px solid var(--border-color)">
      <div class="container-fluid">
        <a class="navbar-brand" href="#" data-i18n="title">Bandwidth Calculator</a>
        <div class="d-flex ms-auto gap-2">
          <select id="lang-switcher" class="form-select form-select-sm" style="width: auto;">
            <option value="en">English</option>
            <option value="pt">Português</option>
            <option value="ja">日本語</option>
          </select>
          <button id="clear-btn" class="btn btn-sm btn-outline-secondary" type="button" data-i18n-title="clearBtn" title="Clear">
            <i class="fas fa-eraser"></i>
          </button>
          <button id="theme-switcher" class="btn btn-sm btn-outline-secondary" type="button" data-i18n-title="themeBtn" title="Toggle theme">
            <i class="fas fa-moon"></i>
          </button>
        </div>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row justify-content-center">
        <div class="col-xl-6 col-lg-8 col-md-10">
          <div class="card">
            <div class="card-header">
              <h4 class="mb-0" data-i18n="cardTitle">Calculate Transfer Rate</h4>
            </div>
            <div class="card-body">
              <div class="row g-3 mb-4">
                <div class="col-sm-8">
                  <label for="size-input" class="form-label" data-i18n="dataSizeLabel">Data Size</label>
                  <input type="number" id="size-input" class="form-control" placeholder="0" min="0" step="any">
                </div>
                <div class="col-sm-4">
                  <label for="size-unit" class="form-label" data-i18n="unitLabel">Unit</label>
                  <select id="size-unit" class="form-select">
                    <option value="MB">MB</option>
                    <option value="GB">GB</option>
                    <option value="TB">TB</option>
                  </select>
                </div>
              </div>

              <div class="row g-3 mb-4">
                <div class="col-sm-8">
                  <label for="time-input" class="form-label" data-i18n="timeLabel">Time</label>
                  <input type="number" id="time-input" class="form-control" placeholder="0" min="0" step="any">
                </div>
                <div class="col-sm-4">
                  <label for="time-unit" class="form-label" data-i18n="unitLabel">Unit</label>
                  <select id="time-unit" class="form-select">
                    <option value="s" data-i18n-option="seconds">Seconds</option>
                    <option value="m" data-i18n-option="minutes">Minutes</option>
                    <option value="h" data-i18n-option="hours">Hours</option>
                  </select>
                </div>
              </div>

              <hr />

              <div id="results-area" style="display: none;">
                <div class="result-box mb-3">
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="help-text" data-i18n="transferRateMB">Transfer Rate (MegaBytes)</span>
                    <button class="btn btn-sm btn-link copy-btn" data-target="result-mb" data-i18n-title="copyBtn" title="Copy">
                      <i class="fas fa-copy"></i>
                    </button>
                  </div>
                  <div id="result-mb" class="result-value">0 MB/s</div>
                </div>

                <div class="result-box">
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="help-text" data-i18n="transferRateMbits">Transfer Rate (MegaBits)</span>
                    <button class="btn btn-sm btn-link copy-btn" data-target="result-mbits" data-i18n-title="copyBtn" title="Copy">
                      <i class="fas fa-copy"></i>
                    </button>
                  </div>
                  <div id="result-mbits" class="result-value">0 Mbps</div>
                </div>
              </div>

              <div id="empty-state" class="text-center py-4 text-muted" data-i18n="emptyState">
                Enter size and time to see the results
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const i18n = {
        en: {
          title: "Bandwidth Calculator",
          cardTitle: "Calculate Transfer Rate",
          dataSizeLabel: "Data Size",
          timeLabel: "Time",
          unitLabel: "Unit",
          seconds: "Seconds",
          minutes: "Minutes",
          hours: "Hours",
          transferRateMB: "Transfer Rate (MegaBytes)",
          transferRateMbits: "Transfer Rate (MegaBits)",
          copyBtn: "Copy",
          clearBtn: "Clear",
          themeBtn: "Toggle theme",
          emptyState: "Enter size and time to see the results"
        },
        pt: {
          title: "Calculadora de Banda",
          cardTitle: "Calcular Taxa de Transferência",
          dataSizeLabel: "Tamanho dos Dados",
          timeLabel: "Tempo",
          unitLabel: "Unidade",
          seconds: "Segundos",
          minutes: "Minutos",
          hours: "Horas",
          transferRateMB: "Taxa de Transferência (MegaBytes)",
          transferRateMbits: "Taxa de Transferência (MegaBits)",
          copyBtn: "Copiar",
          clearBtn: "Limpar",
          themeBtn: "Alternar tema",
          emptyState: "Digite o tamanho e o tempo para ver os resultados"
        },
        ja: {
          title: "帯域幅計算機",
          cardTitle: "転送速度を計算",
          dataSizeLabel: "データサイズ",
          timeLabel: "時間",
          unitLabel: "単位",
          seconds: "秒",
          minutes: "分",
          hours: "時間",
          transferRateMB: "転送速度 (メガバイト)",
          transferRateMbits: "転送速度 (メガビット)",
          copyBtn: "コピー",
          clearBtn: "クリア",
          themeBtn: "テーマを切り替え",
          emptyState: "サイズと時間を入力して結果を表示"
        }
      };

      document.addEventListener('DOMContentLoaded', () => {
        // Elements
        const langSwitcher = document.getElementById('lang-switcher');
        const themeSwitcher = document.getElementById('theme-switcher');
        const clearBtn = document.getElementById('clear-btn');
        const sizeInput = document.getElementById('size-input');
        const sizeUnit = document.getElementById('size-unit');
        const timeInput = document.getElementById('time-input');
        const timeUnit = document.getElementById('time-unit');
        const resultMb = document.getElementById('result-mb');
        const resultMbits = document.getElementById('result-mbits');
        const resultsArea = document.getElementById('results-area');
        const emptyState = document.getElementById('empty-state');
        const copyBtns = document.querySelectorAll('.copy-btn');

        // Language
        let currentLanguage = localStorage.getItem('app_lang') || 'en';
        const applyI18n = () => {
          const lang = i18n[currentLanguage] || i18n.en;
          document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (lang[key]) {
              el.innerText = lang[key];
            }
          });
          document.querySelectorAll('[data-i18n-title]').forEach(el => {
            const key = el.getAttribute('data-i18n-title');
            if (lang[key]) {
              el.title = lang[key];
            }
          });
          document.querySelectorAll('[data-i18n-option]').forEach(el => {
            const key = el.getAttribute('data-i18n-option');
            if (lang[key]) {
              el.textContent = lang[key];
            }
          });
          document.title = lang.title;
        };

        // Theme
        let currentTheme = localStorage.getItem('app_theme') || 'dark';
        const applyTheme = (theme) => {
          document.documentElement.setAttribute('data-theme', theme);
          const icon = themeSwitcher.querySelector('i');
          icon.className = theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
          localStorage.setItem('app_theme', theme);
        };

        // Calculation Logic
        const calculate = () => {
          const size = parseFloat(sizeInput.value);
          const time = parseFloat(timeInput.value);

          if (isNaN(size) || isNaN(time) || time <= 0 || size < 0) {
            resultsArea.style.display = 'none';
            emptyState.style.display = 'block';
            return;
          }

          resultsArea.style.display = 'block';
          emptyState.style.display = 'none';

          // Convert everything to base units: MB and Seconds
          let sizeInMB = size;
          if (sizeUnit.value === 'GB') sizeInMB = size * 1024;
          if (sizeUnit.value === 'TB') sizeInMB = size * 1024 * 1024;

          let timeInS = time;
          if (timeUnit.value === 'm') timeInS = time * 60;
          if (timeUnit.value === 'h') timeInS = time * 3600;

          const mbPerSec = sizeInMB / timeInS;
          const mbitsPerSec = (sizeInMB * 8) / timeInS;

          resultMb.textContent = `${mbPerSec.toLocaleString(undefined, {maximumFractionDigits: 2})} MB/s`;
          resultMbits.textContent = `${mbitsPerSec.toLocaleString(undefined, {maximumFractionDigits: 2})} Mbps`;
        };

        // Events
        langSwitcher.addEventListener('change', (e) => {
          currentLanguage = e.target.value;
          localStorage.setItem('app_lang', currentLanguage);
          applyI18n();
        });

        themeSwitcher.addEventListener('click', () => {
          currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
          applyTheme(currentTheme);
        });

        clearBtn.addEventListener('click', () => {
          sizeInput.value = '';
          timeInput.value = '';
          calculate();
        });

        [sizeInput, sizeUnit, timeInput, timeUnit].forEach(el => {
          el.addEventListener('input', calculate);
        });

        copyBtns.forEach(btn => {
          btn.addEventListener('click', async () => {
            const targetId = btn.getAttribute('data-target');
            const text = document.getElementById(targetId).textContent;
            try {
              await navigator.clipboard.writeText(text);
              const icon = btn.querySelector('i');
              icon.className = 'fas fa-check';
              setTimeout(() => { icon.className = 'fas fa-copy'; }, 1000);
            } catch (err) {
              console.error('Failed to copy: ', err);
            }
          });
        });

        // Init
        langSwitcher.value = currentLanguage;
        applyI18n();
        applyTheme(currentTheme);
        calculate();
      });
    </script>
  </body>
</html>
