<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-i18n="title">Time Difference Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../assets/fontawesome/css/all.min.css" />
    <style>
      :root {
        --bg-color: #1a1a1a;
        --text-color: #f0f0f0;
        --card-bg-color: #2a2a2a;
        --border-color: #444;
        --accent-color: #0d6efd;
      }

      html[data-theme='light'] {
        --bg-color: #f8f9fa;
        --text-color: #212529;
        --card-bg-color: #fff;
        --border-color: #dee2e6;
        --accent-color: #0d6efd;
      }

      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        margin: 0;
      }

      .container-fluid {
        padding-top: 20px;
        padding-bottom: 20px;
        flex: 1;
      }

      .card {
        background-color: var(--card-bg-color);
        border-color: var(--border-color);
      }

      .card-header {
        border-bottom-color: var(--border-color);
      }

      .navbar-brand,
      .form-label {
        color: var(--text-color);
      }

      .form-control, .form-select {
        background-color: var(--card-bg-color);
        color: var(--text-color);
        border-color: var(--border-color);
      }

      .form-control:focus, .form-select:focus {
        background-color: var(--card-bg-color);
        color: var(--text-color);
        border-color: var(--accent-color);
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
      }

      .result-box {
        background-color: rgba(13, 110, 253, 0.1);
        border: 1px solid var(--accent-color);
        border-radius: 8px;
        padding: 15px;
        margin-top: 20px;
      }

      .result-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--accent-color);
      }

      .help-text {
        color: #aaa;
        font-size: 0.9rem;
      }

      .mono {
        font-family: 'Courier New', Courier, monospace;
      }

      .datetime-input-group {
        display: flex;
        gap: 10px;
      }

      .datetime-input-group input {
        flex: 1;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg" style="background-color: var(--card-bg-color); border-bottom: 1px solid var(--border-color)">
      <div class="container-fluid">
        <a class="navbar-brand" href="#" data-i18n="title">Time Difference Calculator</a>
        <div class="d-flex ms-auto gap-2">
          <select id="lang-switcher" class="form-select form-select-sm" style="width: auto;">
            <option value="en">English</option>
            <option value="pt">Português</option>
            <option value="ja">日本語</option>
          </select>
          <button id="clear-btn" class="btn btn-sm btn-outline-secondary" type="button" data-i18n-title="clearBtn" title="Clear">
            <i class="fas fa-eraser"></i>
          </button>
          <button id="theme-switcher" class="btn btn-sm btn-outline-secondary" type="button" data-i18n-title="themeBtn" title="Toggle theme">
            <i class="fas fa-moon"></i>
          </button>
        </div>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row justify-content-center">
        <div class="col-xl-6 col-lg-8 col-md-10">
          <div class="card">
            <div class="card-header">
              <h4 class="mb-0" data-i18n="cardTitle">Calculate Time Difference</h4>
            </div>
            <div class="card-body">
              <div class="mb-4">
                <label class="form-label" data-i18n="fromLabel">From</label>
                <div class="datetime-input-group">
                  <input type="date" id="from-date" class="form-control" />
                  <input type="time" id="from-time" class="form-control" step="1" />
                </div>
              </div>

              <div class="mb-4">
                <label class="form-label" data-i18n="toLabel">To</label>
                <div class="datetime-input-group">
                  <input type="date" id="to-date" class="form-control" />
                  <input type="time" id="to-time" class="form-control" step="1" />
                </div>
              </div>

              <hr />

              <div id="results-area" style="display: none;">
                <div class="result-box mb-3">
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="help-text" data-i18n="hoursMinutesLabel">Hours and Minutes</span>
                    <button class="btn btn-sm btn-link copy-btn" data-target="result-hours-minutes" data-i18n-title="copyBtn" title="Copy">
                      <i class="fas fa-copy"></i>
                    </button>
                  </div>
                  <div id="result-hours-minutes" class="result-value">0 hours 0 minutes</div>
                </div>

                <div class="result-box mb-3">
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="help-text" data-i18n="minutesLabel">Minutes</span>
                    <button class="btn btn-sm btn-link copy-btn" data-target="result-minutes" data-i18n-title="copyBtn" title="Copy">
                      <i class="fas fa-copy"></i>
                    </button>
                  </div>
                  <div id="result-minutes" class="result-value">0 minutes</div>
                </div>

                <div class="result-box">
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="help-text" data-i18n="secondsLabel">Seconds</span>
                    <button class="btn btn-sm btn-link copy-btn" data-target="result-seconds" data-i18n-title="copyBtn" title="Copy">
                      <i class="fas fa-copy"></i>
                    </button>
                  </div>
                  <div id="result-seconds" class="result-value">0 seconds</div>
                </div>
              </div>

              <div id="empty-state" class="text-center py-4 text-muted" data-i18n="emptyState">
                Select dates and times to see the results
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const i18n = {
        en: {
          title: "Time Difference Calculator",
          cardTitle: "Calculate Time Difference",
          fromLabel: "From",
          toLabel: "To",
          minutesLabel: "Minutes",
          hoursMinutesLabel: "Hours and Minutes",
          secondsLabel: "Seconds",
          copyBtn: "Copy",
          clearBtn: "Clear",
          themeBtn: "Toggle theme",
          emptyState: "Select dates and times to see the results"
        },
        pt: {
          title: "Calculadora de Diferença de Tempo",
          cardTitle: "Calcular Diferença de Tempo",
          fromLabel: "De",
          toLabel: "Para",
          minutesLabel: "Minutos",
          hoursMinutesLabel: "Horas e Minutos",
          secondsLabel: "Segundos",
          copyBtn: "Copiar",
          clearBtn: "Limpar",
          themeBtn: "Alternar tema",
          emptyState: "Selecione datas e horas para ver os resultados"
        },
        ja: {
          title: "時間差計算機",
          cardTitle: "時間差を計算",
          fromLabel: "開始",
          toLabel: "終了",
          minutesLabel: "分",
          hoursMinutesLabel: "時間と分",
          secondsLabel: "秒",
          copyBtn: "コピー",
          clearBtn: "クリア",
          themeBtn: "テーマを切り替え",
          emptyState: "日付と時刻を選択して結果を表示"
        }
      };

      document.addEventListener('DOMContentLoaded', () => {
        // Elements
        const langSwitcher = document.getElementById('lang-switcher');
        const themeSwitcher = document.getElementById('theme-switcher');
        const clearBtn = document.getElementById('clear-btn');
        const fromDate = document.getElementById('from-date');
        const fromTime = document.getElementById('from-time');
        const toDate = document.getElementById('to-date');
        const toTime = document.getElementById('to-time');
        const resultMinutes = document.getElementById('result-minutes');
        const resultHoursMinutes = document.getElementById('result-hours-minutes');
        const resultSeconds = document.getElementById('result-seconds');
        const resultsArea = document.getElementById('results-area');
        const emptyState = document.getElementById('empty-state');
        const copyBtns = document.querySelectorAll('.copy-btn');

        // Helper function to format date/time to inputs
        const formatDateForInput = (date) => {
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          return `${year}-${month}-${day}`;
        };

        const formatTimeForInput = (date) => {
          const hours = String(date.getHours()).padStart(2, '0');
          const minutes = String(date.getMinutes()).padStart(2, '0');
          const seconds = String(date.getSeconds()).padStart(2, '0');
          return `${hours}:${minutes}:${seconds}`;
        };

        // Initialize with default values
        const initializeDateTime = () => {
          // Try to load from localStorage first
          const savedFromDate = localStorage.getItem('timeDiff_fromDate');
          const savedFromTime = localStorage.getItem('timeDiff_fromTime');
          const savedToDate = localStorage.getItem('timeDiff_toDate');
          const savedToTime = localStorage.getItem('timeDiff_toTime');

          if (savedFromDate && savedFromTime && savedToDate && savedToTime) {
            // Use saved values
            fromDate.value = savedFromDate;
            fromTime.value = savedFromTime;
            toDate.value = savedToDate;
            toTime.value = savedToTime;
          } else {
            // Use default values
            const now = new Date();
            const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);

            fromDate.value = formatDateForInput(oneHourAgo);
            fromTime.value = formatTimeForInput(oneHourAgo);
            toDate.value = formatDateForInput(now);
            toTime.value = formatTimeForInput(now);
          }
        };

        // Save values to localStorage
        const saveToLocalStorage = () => {
          localStorage.setItem('timeDiff_fromDate', fromDate.value);
          localStorage.setItem('timeDiff_fromTime', fromTime.value);
          localStorage.setItem('timeDiff_toDate', toDate.value);
          localStorage.setItem('timeDiff_toTime', toTime.value);
        };

        // Language
        let currentLanguage = localStorage.getItem('app_lang') || 'en';
        const applyI18n = () => {
          const lang = i18n[currentLanguage] || i18n.en;
          document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (lang[key]) {
              el.innerText = lang[key];
            }
          });
          document.querySelectorAll('[data-i18n-title]').forEach(el => {
            const key = el.getAttribute('data-i18n-title');
            if (lang[key]) {
              el.title = lang[key];
            }
          });
          document.title = lang.title;
        };

        // Theme
        let currentTheme = localStorage.getItem('app_theme') || 'dark';
        const applyTheme = (theme) => {
          document.documentElement.setAttribute('data-theme', theme);
          const icon = themeSwitcher.querySelector('i');
          icon.className = theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
          localStorage.setItem('app_theme', theme);
        };

        // Calculation Logic
        const calculate = () => {
          if (!fromDate.value || !fromTime.value || !toDate.value || !toTime.value) {
            resultsArea.style.display = 'none';
            emptyState.style.display = 'block';
            return;
          }

          const fromDateTime = new Date(`${fromDate.value}T${fromTime.value}`);
          const toDateTime = new Date(`${toDate.value}T${toTime.value}`);

          if (isNaN(fromDateTime.getTime()) || isNaN(toDateTime.getTime())) {
            resultsArea.style.display = 'none';
            emptyState.style.display = 'block';
            return;
          }

          resultsArea.style.display = 'block';
          emptyState.style.display = 'none';

          // Calculate difference in milliseconds
          const diffMs = Math.abs(toDateTime - fromDateTime);
          const diffSeconds = Math.floor(diffMs / 1000);
          const diffMinutes = Math.floor(diffSeconds / 60);
          const diffHours = Math.floor(diffMinutes / 60);

          // Format results
          const hours = diffHours;
          const minutes = diffMinutes % 60;
          const totalMinutes = diffMinutes;
          const seconds = diffSeconds;

          // Update results
          resultMinutes.textContent = `${totalMinutes.toLocaleString()} ${totalMinutes === 1 ? 'minute' : 'minutes'}`;
          resultHoursMinutes.textContent = `${hours} ${hours === 1 ? 'hour' : 'hours'} ${minutes} ${minutes === 1 ? 'minute' : 'minutes'}`;
          resultSeconds.textContent = `${seconds.toLocaleString()} ${seconds === 1 ? 'second' : 'seconds'}`;
        };

        // Events
        langSwitcher.addEventListener('change', (e) => {
          currentLanguage = e.target.value;
          localStorage.setItem('app_lang', currentLanguage);
          applyI18n();
        });

        themeSwitcher.addEventListener('click', () => {
          currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
          applyTheme(currentTheme);
        });

        clearBtn.addEventListener('click', () => {
          // Clear localStorage when clearing
          localStorage.removeItem('timeDiff_fromDate');
          localStorage.removeItem('timeDiff_fromTime');
          localStorage.removeItem('timeDiff_toDate');
          localStorage.removeItem('timeDiff_toTime');
          initializeDateTime();
          saveToLocalStorage();
          calculate();
        });

        [fromDate, fromTime, toDate, toTime].forEach(el => {
          el.addEventListener('input', () => {
            saveToLocalStorage();
            calculate();
          });
        });

        copyBtns.forEach(btn => {
          btn.addEventListener('click', async () => {
            const targetId = btn.getAttribute('data-target');
            const text = document.getElementById(targetId).textContent;
            try {
              await navigator.clipboard.writeText(text);
              const icon = btn.querySelector('i');
              icon.className = 'fas fa-check';
              setTimeout(() => { icon.className = 'fas fa-copy'; }, 1000);
            } catch (err) {
              console.error('Failed to copy: ', err);
            }
          });
        });

        // Init
        langSwitcher.value = currentLanguage;
        applyI18n();
        applyTheme(currentTheme);
        initializeDateTime();
        calculate();
      });
    </script>
  </body>
</html>
