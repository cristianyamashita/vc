<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo de Dominó</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --board-bg: #0a6b3a;
            --domino-bg: #f8f8f8;
            --domino-border: #e0e0e0;
            --pip-color: #1a1a1a;
            --text-color: #ffffff;
            --button-bg: #f39c12;
            --button-hover-bg: #e67e22;
            --action-button-bg: #2980b9;
            --action-button-hover-bg: #3498db;
            --shadow-color: rgba(0, 0, 0, 0.2);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #0c4b33;
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            height: 100vh;
            overflow: hidden;
        }

        .top-bar {
            width: 100%;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(0,0,0,0.1);
            box-sizing: border-box;
        }

        .top-bar h1 {
            margin: 0;
            font-size: 1.5em;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        #lang-selector, #new-game-btn {
            padding: 8px 15px;
            border-radius: 8px;
            border: none;
            background-color: var(--button-bg);
            color: var(--text-color);
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #lang-selector:hover, #new-game-btn:hover {
            background-color: var(--button-hover-bg);
        }

        .game-container {
            flex-grow: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        #game-board {
            background-color: var(--board-bg);
            border: 10px solid #38220f;
            border-radius: 15px;
            width: 90vw;
            height: 60vh;
            padding: 20px;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
            position: relative;
        }
        
        #board-chain {
            display: flex;
            align-items: center;
        }

        .domino {
            width: 50px;
            height: 100px;
            background-color: var(--domino-bg);
            border: 1px solid var(--domino-border);
            border-radius: 8px;
            box-shadow: 3px 3px 5px var(--shadow-color);
            display: flex;
            flex-direction: column;
            padding: 5px;
            box-sizing: border-box;
            flex-shrink: 0;
            position: relative;
        }
        
        .domino.horizontal {
            width: 100px;
            height: 50px;
            flex-direction: row;
        }

        .domino-half {
            flex: 1;
            display: grid;
            place-items: center;
            position: relative;
        }
        
        .domino.horizontal .domino-half {
            border-top: none;
            border-right: 1px solid var(--domino-border);
        }

        .domino.horizontal .domino-half:last-child {
            border-right: none;
        }
        
        .divider {
            height: 2px;
            background-color: var(--pip-color);
            margin: 2px 0;
        }

        .domino.horizontal .divider {
            width: 2px;
            height: auto;
            margin: 0 2px;
        }

        .pip-container {
            width: 90%;
            height: 90%;
            display: grid;
            grid-template-areas:
                "a . c"
                "e g f"
                "d . b";
            grid-template-rows: 1fr 1fr 1fr;
            grid-template-columns: 1fr 1fr 1fr;
        }

        .pip {
            width: 8px;
            height: 8px;
            background-color: var(--pip-color);
            border-radius: 50%;
            align-self: center;
            justify-self: center;
        }

        .pip[data-value="1"] { grid-area: g; }
        .pip[data-value="2"]:nth-of-type(1) { grid-area: a; }
        .pip[data-value="2"]:nth-of-type(2) { grid-area: b; }
        .pip[data-value="3"]:nth-of-type(1) { grid-area: a; }
        .pip[data-value="3"]:nth-of-type(2) { grid-area: g; }
        .pip[data-value="3"]:nth-of-type(3) { grid-area: b; }
        .pip[data-value="4"]:nth-of-type(1) { grid-area: a; }
        .pip[data-value="4"]:nth-of-type(2) { grid-area: c; }
        .pip[data-value="4"]:nth-of-type(3) { grid-area: d; }
        .pip[data-value="4"]:nth-of-type(4) { grid-area: b; }
        .pip[data-value="5"]:nth-of-type(1) { grid-area: a; }
        .pip[data-value="5"]:nth-of-type(2) { grid-area: c; }
        .pip[data-value="5"]:nth-of-type(3) { grid-area: g; }
        .pip[data-value="5"]:nth-of-type(4) { grid-area: d; }
        .pip[data-value="5"]:nth-of-type(5) { grid-area: b; }
        .pip[data-value="6"]:nth-of-type(1) { grid-area: a; }
        .pip[data-value="6"]:nth-of-type(2) { grid-area: c; }
        .pip[data-value="6"]:nth-of-type(3) { grid-area: e; }
        .pip[data-value="6"]:nth-of-type(4) { grid-area: f; }
        .pip[data-value="6"]:nth-of-type(5) { grid-area: d; }
        .pip[data-value="6"]:nth-of-type(6) { grid-area: b; }

        .player-area {
            width: 100%;
            background-color: rgba(0,0,0,0.2);
            padding: 15px;
            box-sizing: border-box;
        }

        .player-actions {
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }

        #draw-btn, #pass-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            background-color: var(--action-button-bg);
            color: var(--text-color);
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 1em;
        }
        #draw-btn:hover, #pass-btn:hover {
            background-color: var(--action-button-hover-bg);
        }

        .player-hand {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            min-height: 110px;
            flex-wrap: wrap;
        }
        
        .player-hand .domino {
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s;
        }

        .player-hand .domino:hover {
            transform: translateY(-10px);
            box-shadow: 5px 15px 15px var(--shadow-color);
        }

        .player-hand .domino.invalid {
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .player-hand .domino.invalid:hover {
            transform: none;
            box-shadow: 3px 3px 5px var(--shadow-color);
        }

        .game-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: rgba(0,0,0,0.5);
            padding: 10px 15px;
            border-radius: 10px;
            text-align: left;
        }

        #status-message {
            font-size: 1.2em;
            font-weight: 600;
            margin: 0;
            margin-bottom: 5px;
        }
        
        #boneyard-count {
            margin: 0;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #f0f0f0;
            color: #333;
            padding: 30px 40px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .modal-content h2 {
            margin-top: 0;
            font-size: 2em;
            color: var(--board-bg);
        }
    </style>
</head>
<body>

    <div class="top-bar">
        <h1 data-lang-key="title">Jogo de Dominó</h1>
        <div class="controls">
            <select id="lang-selector">
                <option value="pt">Português</option>
                <option value="en">English</option>
                <option value="ja">日本語</option>
            </select>
            <button id="new-game-btn" data-lang-key="newGame">Novo Jogo</button>
        </div>
    </div>

    <div class="game-container">
        <div id="game-board">
            <div id="board-chain"></div>
        </div>
        <div class="game-info">
            <p id="status-message" data-lang-key="welcome">Bem-vindo!</p>
            <p id="boneyard-count" data-lang-key="boneyard">Boneyard: 28</p>
        </div>
    </div>

    <div class="player-area">
        <div class="player-actions">
            <button id="draw-btn" data-lang-key="drawTile" style="display: none;">Comprar Peça</button>
            <button id="pass-btn" data-lang-key="passTurn" style="display: none;">Passar a Vez</button>
        </div>
        <div class="player-hand" id="player-hand">
            <!-- Dominoes do jogador aqui -->
        </div>
    </div>

    <div class="modal-overlay" id="game-over-modal">
        <div class="modal-content">
            <h2 id="game-over-message"></h2>
            <p id="game-over-details"></p>
        </div>
    </div>

    <script>
        // Dicionário de traduções
        const translations = {
            pt: {
                title: "Jogo de Dominó",
                newGame: "Novo Jogo",
                welcome: "Bem-vindo!",
                boneyard: "Boneyard: {count}",
                playerTurn: "Sua vez",
                computerTurn: "Vez do Computador",
                playerWins: "Você Venceu!",
                computerWins: "O Computador Venceu!",
                draw: "Empate!",
                blockedGame: "Jogo Bloqueado!",
                playerPasses: "Você passou a vez.",
                computerPasses: "O computador passou a vez.",
                invalidMove: "Jogada inválida!",
                drawingDomino: "Comprando do boneyard...",
                playerPoints: "Seus pontos: {points}",
                computerPoints: "Pontos do Computador: {points}",
                drawTile: "Comprar Peça",
                passTurn: "Passar a Vez",
            },
            en: {
                title: "Dominoes Game",
                newGame: "New Game",
                welcome: "Welcome!",
                boneyard: "Boneyard: {count}",
                playerTurn: "Your Turn",
                computerTurn: "Computer's Turn",
                playerWins: "You Win!",
                computerWins: "The Computer Wins!",
                draw: "It's a Draw!",
                blockedGame: "Game is Blocked!",
                playerPasses: "You passed your turn.",
                computerPasses: "The computer passed its turn.",
                invalidMove: "Invalid move!",
                drawingDomino: "Drawing from the boneyard...",
                playerPoints: "Your points: {points}",
                computerPoints: "Computer's points: {points}",
                drawTile: "Draw Tile",
                passTurn: "Pass Turn",
            },
            ja: {
                title: "ドミノゲーム",
                newGame: "新しいゲーム",
                welcome: "ようこそ！",
                boneyard: "ボーンヤード: {count}",
                playerTurn: "あなたの番です",
                computerTurn: "コンピューターの番",
                playerWins: "あなたの勝ちです！",
                computerWins: "コンピューターの勝ち！",
                draw: "引き分けです！",
                blockedGame: "ゲームがブロックされました！",
                playerPasses: "あなたはパスしました。",
                computerPasses: "コンピューターはパスしました。",
                invalidMove: "無効な動きです！",
                drawingDomino: "ボーンヤードから引いています...",
                playerPoints: "あなたのポイント: {points}",
                computerPoints: "コンピューターのポイント: {points}",
                drawTile: "山から引く",
                passTurn: "パスする",
            }
        };

        // Elementos do DOM
        const langSelector = document.getElementById('lang-selector');
        const newGameBtn = document.getElementById('new-game-btn');
        const playerHandDiv = document.getElementById('player-hand');
        const boardChainDiv = document.getElementById('board-chain');
        const statusMessage = document.getElementById('status-message');
        const boneyardCount = document.getElementById('boneyard-count');
        const gameOverModal = document.getElementById('game-over-modal');
        const gameOverMessage = document.getElementById('game-over-message');
        const gameOverDetails = document.getElementById('game-over-details');
        const drawBtn = document.getElementById('draw-btn');
        const passBtn = document.getElementById('pass-btn');

        // Estado do jogo
        let fullSet = [];
        let playerHand = [];
        let computerHand = [];
        let boneyard = [];
        let board = [];
        let openEnds = [];
        let currentPlayer = 'player';
        let gameActive = false;
        let currentLang = 'pt';

        // --- Funções de Internacionalização (i18n) ---
        function updateLanguage() {
            currentLang = langSelector.value;
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (translations[currentLang][key]) {
                    let text = translations[currentLang][key];
                    if (element.id === 'boneyard-count') {
                        text = text.replace('{count}', boneyard.length);
                    }
                    element.textContent = text;
                }
            });
            if (gameActive) {
                updateStatusMessage();
            }
        }

        function getText(key, replacements = {}) {
            let text = translations[currentLang][key] || key;
            for (const placeholder in replacements) {
                text = text.replace(`{${placeholder}}`, replacements[placeholder]);
            }
            return text;
        }
        
        // --- Funções de Renderização e UI ---

        function createPip(value) {
            const pip = document.createElement('div');
            pip.className = 'pip';
            pip.dataset.value = value;
            return pip;
        }

        function createDominoElement(domino, visualOrder) {
            const valuesToRender = visualOrder || domino.values;
            const dominoEl = document.createElement('div');
            dominoEl.className = 'domino';
            dominoEl.dataset.value = `${domino.values[0]}-${domino.values[1]}`;

            const half1 = document.createElement('div');
            half1.className = 'domino-half';
            const pips1 = document.createElement('div');
            pips1.className = 'pip-container';
            for (let i = 0; i < valuesToRender[0]; i++) pips1.appendChild(createPip(valuesToRender[0]));
            half1.appendChild(pips1);

            const divider = document.createElement('div');
            divider.className = 'divider';

            const half2 = document.createElement('div');
            half2.className = 'domino-half';
            const pips2 = document.createElement('div');
            pips2.className = 'pip-container';
            for (let i = 0; i < valuesToRender[1]; i++) pips2.appendChild(createPip(valuesToRender[1]));
            half2.appendChild(pips2);
            
            dominoEl.appendChild(half1);
            dominoEl.appendChild(divider);
            dominoEl.appendChild(half2);

            return dominoEl;
        }

        function renderPlayerHand() {
            playerHandDiv.innerHTML = '';
            playerHand.forEach(domino => {
                const dominoEl = createDominoElement(domino);
                if (currentPlayer === 'player' && gameActive) {
                    const isValid = isValidMove(domino);
                    if (!isValid) {
                        dominoEl.classList.add('invalid');
                    }
                    dominoEl.addEventListener('click', () => handlePlayerMove(domino));
                }
                playerHandDiv.appendChild(dominoEl);
            });
        }

        function renderBoard() {
            boardChainDiv.innerHTML = '';
            board.forEach(dominoData => {
                const dominoEl = createDominoElement(dominoData.original, dominoData.visualOrder);
                
                if (dominoData.original.values[0] === dominoData.original.values[1]) {
                    dominoEl.classList.add('vertical');
                } else {
                    dominoEl.classList.add('horizontal');
                }
                
                boardChainDiv.appendChild(dominoEl);
            });
        }

        function updateActionButtons() {
            const playerCanPlay = playerHand.some(isValidMove);
            if (currentPlayer === 'player' && !playerCanPlay && gameActive) {
                if (boneyard.length > 0) {
                    drawBtn.style.display = 'block';
                    passBtn.style.display = 'none';
                } else {
                    drawBtn.style.display = 'none';
                    passBtn.style.display = 'block';
                }
            } else {
                drawBtn.style.display = 'none';
                passBtn.style.display = 'none';
            }
        }

        function updateUI() {
            renderPlayerHand();
            renderBoard();
            boneyardCount.textContent = getText('boneyard', { count: boneyard.length });
            updateStatusMessage();
            updateActionButtons();
        }
        
        function updateStatusMessage() {
            if (!gameActive) return;
            statusMessage.textContent = getText(currentPlayer === 'player' ? 'playerTurn' : 'computerTurn');
        }

        // --- Lógica do Jogo ---

        function initGame() {
            gameActive = true;
            gameOverModal.style.display = 'none';
            board = [];
            
            fullSet = [];
            for (let i = 0; i <= 6; i++) {
                for (let j = i; j <= 6; j++) {
                    fullSet.push({ values: [i, j], id: `${i}-${j}` });
                }
            }

            for (let i = fullSet.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [fullSet[i], fullSet[j]] = [fullSet[j], fullSet[i]];
            }

            playerHand = fullSet.slice(0, 7);
            computerHand = fullSet.slice(7, 14);
            boneyard = fullSet.slice(14);
            
            let playerMaxDouble = -1, computerMaxDouble = -1;
            let playerStartDomino = null, computerStartDomino = null;

            playerHand.forEach(d => { if (d.values[0] === d.values[1] && d.values[0] > playerMaxDouble) { playerMaxDouble = d.values[0]; playerStartDomino = d; } });
            computerHand.forEach(d => { if (d.values[0] === d.values[1] && d.values[0] > computerMaxDouble) { computerMaxDouble = d.values[0]; computerStartDomino = d; } });

            if (playerMaxDouble >= computerMaxDouble && playerMaxDouble !== -1) {
                currentPlayer = 'player';
                playDomino(playerStartDomino, 'player', 'start');
            } else if (computerMaxDouble > playerMaxDouble) {
                currentPlayer = 'computer';
                playDomino(computerStartDomino, 'computer', 'start');
            } else {
                 currentPlayer = 'player';
            }

            updateUI();
            
            if (currentPlayer === 'computer') {
                setTimeout(computerTurn, 1500);
            }
        }
        
        function isValidMove(domino) {
            if (board.length === 0) return true;
            return domino.values.includes(openEnds[0]) || domino.values.includes(openEnds[1]);
        }
        
        function playDomino(domino, player, side) {
            if (player === 'player') {
                playerHand = playerHand.filter(d => d.id !== domino.id);
            } else {
                computerHand = computerHand.filter(d => d.id !== domino.id);
            }

            let visualOrder;
            
            if (board.length === 0) {
                openEnds = [...domino.values];
                visualOrder = [...domino.values];
                board.push({ original: domino, visualOrder: visualOrder });
            } else {
                if (side === 'start') {
                    const connectingValue = openEnds[0];
                    const otherValue = domino.values[0] === connectingValue ? domino.values[1] : domino.values[0];
                    visualOrder = [otherValue, connectingValue];
                    board.unshift({ original: domino, visualOrder: visualOrder });
                    openEnds[0] = otherValue;
                } else { // side === 'end'
                    const connectingValue = openEnds[1];
                    const otherValue = domino.values[0] === connectingValue ? domino.values[1] : domino.values[0];
                    visualOrder = [connectingValue, otherValue];
                    board.push({ original: domino, visualOrder: visualOrder });
                    openEnds[1] = otherValue;
                }
            }
        }
        
        function handlePlayerMove(domino) {
            if (currentPlayer !== 'player' || !gameActive) return;

            if (!isValidMove(domino)) {
                statusMessage.textContent = getText('invalidMove');
                setTimeout(updateStatusMessage, 1500);
                return;
            }

            let side = null;
            if (board.length === 0) {
                 side = 'start';
            } else if (domino.values.includes(openEnds[1])) {
                side = 'end';
            } else if (domino.values.includes(openEnds[0])) {
                side = 'start';
            }
            
            playDomino(domino, 'player', side);
            
            if (checkGameOver()) return;

            currentPlayer = 'computer';
            updateUI();
            setTimeout(computerTurn, 1500);
        }

        function drawFromBoneyard(player) {
            if (boneyard.length > 0) {
                const drawnDomino = boneyard.pop();
                if (player === 'player') {
                    playerHand.push(drawnDomino);
                } else {
                    computerHand.push(drawnDomino);
                }
                updateUI();
                return drawnDomino;
            }
            return null;
        }

        function playerTryToDraw() {
            if (currentPlayer !== 'player' || !gameActive || boneyard.length === 0) return;
            statusMessage.textContent = getText('drawingDomino');
            setTimeout(() => { // Pequeno delay para o jogador ver a mensagem
                drawFromBoneyard('player');
            }, 300);
        }

        function playerPassTurn() {
            if (currentPlayer !== 'player' || !gameActive) return;
            statusMessage.textContent = getText('playerPasses');
            currentPlayer = 'computer';
            setTimeout(() => {
                updateUI();
                if (checkIfBlocked()) return;
                computerTurn();
            }, 1500);
        }
        
        function computerTurn() {
            if (currentPlayer !== 'computer' || !gameActive) return;

            let move = findBestComputerMove();

            if (move) {
                playDomino(move.domino, 'computer', move.side);
            } else {
                let canPlay = false;
                while (boneyard.length > 0 && !canPlay) {
                    const drawnDomino = drawFromBoneyard('computer');
                    if (isValidMove(drawnDomino)) {
                        move = findBestComputerMove();
                        if (move) { // Safety check
                            playDomino(move.domino, 'computer', move.side);
                            canPlay = true;
                        }
                    }
                }
                if (!canPlay) {
                    statusMessage.textContent = getText('computerPasses');
                    if (checkIfBlocked()) return;
                }
            }

            if (checkGameOver()) return;

            currentPlayer = 'player';
            updateUI();
        }

        /**
         * Finds the best possible move for the computer.
         * This corrected version ensures all valid moves are considered.
         */
        function findBestComputerMove() {
            const validMoves = [];
            computerHand.forEach(domino => {
                // Prioritize playing on the end of the chain
                if (domino.values.includes(openEnds[1])) {
                    validMoves.push({ domino, side: 'end' });
                // If it can't play on the end, check the start
                } else if (domino.values.includes(openEnds[0])) {
                    validMoves.push({ domino, side: 'start' });
                }
            });

            if (validMoves.length === 0) return null;

            // Sort valid moves by the highest score to play heavier pieces first
            validMoves.sort((a, b) => (b.domino.values[0] + b.domino.values[1]) - (a.domino.values[0] + a.domino.values[1]));
            
            return validMoves[0];
        }

        function checkGameOver() {
            if (playerHand.length === 0) {
                endGame('player');
                return true;
            }
            if (computerHand.length === 0) {
                endGame('computer');
                return true;
            }
            return checkIfBlocked();
        }

        function checkIfBlocked() {
            const playerCanPlay = playerHand.some(isValidMove);
            const computerCanPlay = computerHand.some(d => isValidMove(d));

            if (boneyard.length === 0 && !playerCanPlay && !computerCanPlay) {
                endGame('blocked');
                return true;
            }
            return false;
        }

        function endGame(winner) {
            gameActive = false;
            let message = '';
            let details = '';

            if (winner === 'player') {
                message = getText('playerWins');
            } else if (winner === 'computer') {
                message = getText('computerWins');
            } else { // Blocked
                message = getText('blockedGame');
                const playerPoints = playerHand.reduce((sum, d) => sum + d.values[0] + d.values[1], 0);
                const computerPoints = computerHand.reduce((sum, d) => sum + d.values[0] + d.values[1], 0);
                
                details = `${getText('playerPoints', {points: playerPoints})} | ${getText('computerPoints', {points: computerPoints})}`;

                if (playerPoints < computerPoints) {
                    message = getText('playerWins');
                } else if (computerPoints < playerPoints) {
                    message = getText('computerWins');
                } else {
                    message = getText('draw');
                }
            }
            
            gameOverMessage.textContent = message;
            gameOverDetails.textContent = details;
            gameOverModal.style.display = 'flex';
        }

        // --- Event Listeners ---
        langSelector.addEventListener('change', updateLanguage);
        newGameBtn.addEventListener('click', initGame);
        drawBtn.addEventListener('click', playerTryToDraw);
        passBtn.addEventListener('click', playerPassTurn);
        
        gameOverModal.addEventListener('click', () => {
            gameOverModal.style.display = 'none';
        });

        // Início
        window.onload = () => {
            updateLanguage();
            initGame();
        };

    </script>
</body>
</html>
