<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Math Quiz Game</title>
  <style>
    :root {
      --bg-1: #0b0f14;
      --bg-2: #0a0f1a;
      --card: #0f1623cc;
      --ink: #dbe7ff;
      --muted: #92a3ba;
      --border: #1f2a3f;
      --accent: #4ea1ff;
      --accent-2: #86efac;
      --shadow: 0 18px 60px rgba(0,0,0,.40);
      --danger: #ff4d4d;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      color: var(--ink);
      font: 14px/1.55 'Noto Sans JP', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans';
      background: var(--bg-1);
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .game-wrapper {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      width: 100%;
      max-width: 800px;
      padding: 20px;
    }
    @media (min-width: 680px) {
      .game-wrapper {
        grid-template-columns: 3fr 1fr;
      }
    }
    .game-container {
      background: var(--card);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .sidebar {
      background: var(--card);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }
    .question-container {
      font-size: 3.5rem;
      font-weight: bold;
      text-align: center;
      margin: 20px 0;
      color: var(--accent-2);
    }
    .answer-input {
      width: 100%;
      font-size: 2.5rem;
      text-align: center;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--bg-2);
      color: var(--ink);
      margin-bottom: 20px;
    }
    .keypad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .keypad button {
      font-size: 1.8rem;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--bg-2);
      color: var(--ink);
      cursor: pointer;
      transition: background-color 0.2s, color 0.2s;
    }
    .keypad button:hover {
      background: var(--accent);
      color: var(--bg-1);
    }
    .keypad .op-key {
      background-color: var(--accent);
      color: var(--bg-1);
    }
     .keypad .op-key:hover {
      background-color: var(--ink);
    }
    .game-info {
      display: flex;
      justify-content: space-between;
      font-size: 1.4rem;
      margin-bottom: 20px;
    }
    .results-screen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .results-screen h2 {
      font-size: 2.5rem;
      margin-bottom: 20px;
    }
    .results-screen p {
      font-size: 1.5rem;
      margin-bottom: 10px;
    }
    .btn {
      cursor: pointer;
      padding: 10px 20px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--accent);
      color: var(--bg-1);
      font-weight: bold;
      margin-top: 20px;
    }
    .btn:hover {
      background-color: #2f6bff;
    }
    .lang-selector {
      margin-bottom: 20px;
    }
    .lang-selector a {
      color: var(--muted);
      text-decoration: none;
      font-size: 13px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 8px;
      border: 1px solid transparent;
    }
    .lang-selector a:hover {
      border-color: var(--border);
    }
    .lang-selector a.active {
      color: var(--accent);
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <div class="game-container">
      <div id="game-view">
        <div class="game-info">
          <div>Time: <span id="timer">10</span>s</div>
          <div>Score: <span id="score">0</span></div>
          <div>Chances: <span id="chances">3</span></div>
        </div>
        <div class="question-container" id="question">1 + 1</div>
        <input type="text" class="answer-input" id="answer" autofocus />
        <div class="keypad">
          <button data-key="1">1</button>
          <button data-key="2">2</button>
          <button data-key="3">3</button>
          <button data-key="4">4</button>
          <button data-key="5">5</button>
          <button data-key="6">6</button>
          <button data-key="7">7</button>
          <button data-key="8">8</button>
          <button data-key="9">9</button>
          <button data-key="C" class="op-key">C</button>
          <button data-key="0">0</button>
          <button data-key="OK" class="op-key">OK</button>
        </div>
      </div>
      <div id="results-view" class="results-screen">
        <h2 data-i18n="resultsTitle">Game Over</h2>
        <p><span data-i18n="finalScore">Final Score:</span> <span id="final-score">0</span></p>
        <p><span data-i18n="highScore">High Score:</span> <span id="high-score">0</span></p>
        <button id="play-again-btn" class="btn" data-i18n="playAgain">Play Again</button>
      </div>
    </div>
    <div class="sidebar">
      <h2 data-i18n="settingsTitle">Settings</h2>
      <div class="lang-selector">
        <a href="#" data-lang="en" class="active">EN</a>
        <a href="#" data-lang="ja">JA</a>
        <a href="#" data-lang="pt">PT</a>
      </div>
      <div>
        <label for="difficulty" data-i18n="difficultyLabel">Difficulty:</label>
        <select id="difficulty">
          <option value="easy" data-i18n="difficultyEasy">Easy</option>
          <option value="medium" data-i18n="difficultyMedium">Medium</option>
          <option value="hard" data-i18n="difficultyHard">Hard</option>
        </select>
      </div>
      <button id="start-btn" class="btn" data-i18n="startBtn">Start Game</button>
      <button id="pause-btn" class="btn" data-i18n="pauseBtn">Pause</button>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const dom = {
        gameView: document.getElementById('game-view'),
        resultsView: document.getElementById('results-view'),
        question: document.getElementById('question'),
        answer: document.getElementById('answer'),
        timer: document.getElementById('timer'),
        score: document.getElementById('score'),
        chances: document.getElementById('chances'),
        finalScore: document.getElementById('final-score'),
        highScore: document.getElementById('high-score'),
        keypad: document.querySelector('.keypad'),
        startBtn: document.getElementById('start-btn'),
        pauseBtn: document.getElementById('pause-btn'),
        playAgainBtn: document.getElementById('play-again-btn'),
        difficulty: document.getElementById('difficulty'),
        langSelector: document.querySelector('.lang-selector'),
      };

      const state = {
        score: 0,
        timeLeft: 10,
        chances: 3,
        timerId: null,
        currentQuestion: null,
        difficulty: 'easy',
        paused: false,
        gameOver: true,
        highScore: localStorage.getItem('mathQuizHighScore') || 0,
      };

      const translations = {
        en: {
          resultsTitle: "Game Over",
          finalScore: "Final Score:",
          highScore: "High Score:",
          playAgain: "Play Again",
          settingsTitle: "Settings",
          difficultyLabel: "Difficulty:",
          difficultyEasy: "Easy",
          difficultyMedium: "Medium",
          difficultyHard: "Hard",
          startBtn: "Start Game",
          pauseBtn: "Pause",
        },
        ja: {
          resultsTitle: "ゲームオーバー",
          finalScore: "最終スコア:",
          highScore: "ハイスコア:",
          playAgain: "もう一度プレイ",
          settingsTitle: "設定",
          difficultyLabel: "難易度:",
          difficultyEasy: "簡単",
          difficultyMedium: "普通",
          difficultyHard: "難しい",
          startBtn: "ゲーム開始",
          pauseBtn: "一時停止",
        },
        pt: {
          resultsTitle: "Fim de Jogo",
          finalScore: "Pontuação Final:",
          highScore: "Pontuação Máxima:",
          playAgain: "Jogar Novamente",
          settingsTitle: "Configurações",
          difficultyLabel: "Dificuldade:",
          difficultyEasy: "Fácil",
          difficultyMedium: "Médio",
          difficultyHard: "Difícil",
          startBtn: "Começar",
          pauseBtn: "Pausar",
        }
      };

      let audioCtx;
      const correctSound = () => playTone(440, 0.1, 'sine');
      const incorrectSound = () => playTone(220, 0.2, 'square');

      function playTone(frequency, duration, type) {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        oscillator.type = type;
        oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
        gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
        oscillator.start();
        oscillator.stop(audioCtx.currentTime + duration);
      }

      function generateQuestion() {
        const ops = ['+', '-', '*', '/'];
        let operator = ops[Math.floor(Math.random() * ops.length)];
        let num1, num2, answer;

        const range = {
          easy: [1, 10],
          medium: [1, 50],
          hard: [10, 100],
        }[state.difficulty];

        do {
            num1 = Math.floor(Math.random() * (range[1] - range[0] + 1)) + range[0];
            num2 = Math.floor(Math.random() * (range[1] - range[0] + 1)) + range[0];

            if (operator === '/') {
                if (num2 === 0) continue;
                num1 = num1 * num2; // Ensure whole number division
            }
            if (operator === '-') {
                if (num1 < num2) [num1, num2] = [num2, num1]; // Ensure positive result
            }

            switch (operator) {
                case '+': answer = num1 + num2; break;
                case '-': answer = num1 - num2; break;
                case '*': answer = num1 * num2; break;
                case '/': answer = num1 / num2; break;
            }
        } while (answer === undefined);

        state.currentQuestion = { num1, num2, operator, answer };
        dom.question.textContent = `${num1} ${operator} ${num2}`;
      }

      function checkAnswer() {
        const userAnswer = parseInt(dom.answer.value, 10);
        if (userAnswer === state.currentQuestion.answer) {
          state.score += 10;
          state.chances = 3;
          correctSound();
          updateScore();
          updateChances();
          generateQuestion();
          resetTimer();
        } else {
          incorrectSound();
          state.chances--;
          updateChances();
          if (state.chances <= 0) {
            endGame();
          }
        }
        dom.answer.value = '';
        dom.answer.focus();
      }

      function updateScore() {
        dom.score.textContent = state.score;
      }

      function updateChances() {
        dom.chances.textContent = state.chances;
      }

      function resetTimer() {
        clearInterval(state.timerId);
        state.timeLeft = 10;
        dom.timer.textContent = state.timeLeft;
        state.timerId = setInterval(countdown, 1000);
      }

      function countdown() {
        if (state.paused) return;
        state.timeLeft--;
        dom.timer.textContent = state.timeLeft;
        if (state.timeLeft <= 0) {
          endGame();
        }
      }

      function startGame() {
        state.gameOver = false;
        state.score = 0;
        state.chances = 3;
        updateScore();
        updateChances();
        dom.gameView.style.display = 'block';
        dom.resultsView.style.display = 'none';
        dom.answer.disabled = false;
        dom.answer.focus();
        generateQuestion();
        resetTimer();
      }

      function endGame() {
        state.gameOver = true;
        clearInterval(state.timerId);
        dom.answer.disabled = true;
        if (state.score > state.highScore) {
          state.highScore = state.score;
          localStorage.setItem('mathQuizHighScore', state.highScore);
        }
        dom.finalScore.textContent = state.score;
        dom.highScore.textContent = state.highScore;
        dom.gameView.style.display = 'none';
        dom.resultsView.style.display = 'flex';
      }

      function setLanguage(lang) {
        document.querySelectorAll('[data-i18n]').forEach(el => {
          const key = el.getAttribute('data-i18n');
          if (translations[lang] && translations[lang][key]) {
            el.textContent = translations[lang][key];
          }
        });
        document.documentElement.lang = lang;
        localStorage.setItem('app_lang', lang);
        dom.langSelector.querySelectorAll('a').forEach(a => {
          a.classList.remove('active');
          if (a.getAttribute('data-lang') === lang) a.classList.add('active');
        });
      }

      dom.keypad.addEventListener('click', (e) => {
        if (state.gameOver || state.paused) return;
        const key = e.target.dataset.key;
        if (key) {
          if (key === 'OK') {
            checkAnswer();
          } else if (key === 'C') {
            dom.answer.value = '';
          } else {
            dom.answer.value += key;
          }
        }
      });

      dom.answer.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          checkAnswer();
        }
      });

      dom.startBtn.addEventListener('click', startGame);
      dom.playAgainBtn.addEventListener('click', startGame);

      dom.pauseBtn.addEventListener('click', () => {
        state.paused = !state.paused;
        dom.pauseBtn.textContent = state.paused ? 'Resume' : 'Pause';
        if(state.paused) {
            clearInterval(state.timerId);
        } else {
            state.timerId = setInterval(countdown, 1000);
        }
      });

      dom.difficulty.addEventListener('change', (e) => {
        state.difficulty = e.target.value;
      });

      dom.langSelector.addEventListener('click', (e) => {
        e.preventDefault();
        const lang = e.target.getAttribute('data-lang');
        if (lang) {
          setLanguage(lang);
        }
      });

      const savedLang = localStorage.getItem('app_lang') || 'en';
      setLanguage(savedLang);
      dom.highScore.textContent = state.highScore;
      dom.gameView.style.display = 'none';
      dom.resultsView.style.display = 'flex';
      endGame(); // Show results screen initially
    });
  </script>
</body>
</html>
